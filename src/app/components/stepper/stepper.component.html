<ngx-spinner type="cube-transition" *ngIf="loading">
  <p class="text-white">{{ 'loading.creating' | translate }}...</p>
</ngx-spinner>

<div *ngIf="!loading" class="stepper-container">
  <!-- Progress Stepper -->
  <!--  <div class="stepper">
    <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
      <div class="step-circle">1</div>
      <div class="step-line" [class.active]="currentStep > 1"></div>
    </div>
    <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
      <div class="step-circle">2</div>
      <div class="step-line" [class.active]="currentStep > 2"></div>
    </div>
    <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
      <div class="step-circle">3</div>
    </div>
  </div> -->

  <div class="stepper">
    <h2 *ngIf="currentStep === 1" class="font-bold mb-3 underline text-lg">
      {{ 'checkin.step' | translate }} {{ currentStep }}
    </h2>
    <h2 *ngIf="currentStep === 2" class="font-bold mb-3 underline text-lg">
      {{ 'checkin.step' | translate }} {{ currentStep }}
    </h2>
    <h2
      *ngIf="currentStep === 3"
      class="font-bold mb-3 underline text-lg bg-white py-2 px-6 rounded-md relative z-1000"
    >
      {{ 'checkin.step' | translate }} {{ currentStep }}
    </h2>
  </div>

  <!-- Step 1: Choose Activities -->
  <div class="content" *ngIf="currentStep === 1">
    <h2 class="title">{{ 'checkin.chooseActivities' | translate }}:</h2>

    <div *ngIf="!loading" class="activities-grid">
      <div
        role="button"
        tabindex="0"
        *ngFor="let activity of activities"
        class="hover:scale-[1.02] flex flex-col items-center cursor-pointer"
        [class.selected]="isActivitySelected(activity)"
        (click)="toggleActivity(activity)"
      >
        <div
          class="h-32 w-32 flex justify-center items-center text-8xl pb-4 rounded-2xl bg-gray-200/90 hover:bg-[#1e4d8b]"
        >
          {{ activity.emoji || 'ğŸ˜Š' }}
        </div>
        <div class="uppercase font-black text-center text-lg text-[#1e4d8b]">
          {{ activity.name }}
        </div>
      </div>
    </div>

    <!-- <div class="navigation">
      <button class="nav-button next" (click)="nextStep()" [disabled]="selectedActivities.length === 0">
        <span class="arrow">â†’</span>
      </button>
    </div> -->
  </div>

  <!-- Step 2: Checkout Time -->
  <div class="content" *ngIf="currentStep === 2">
    <h2 class="title">{{ 'checkin.leavingTime' | translate }}:</h2>

    <div class="time-picker">
      <!-- Finger pointing to hour picker -->
      <img
        class="w-16 finger-pointer finger-hour"
        *ngIf="!hourSelected && !showHourPicker"
        src="/pointing-right-finger-svgrepo-com.svg"
        alt="Finger pointing to the right"
      />

      <!-- Finger pointing to minute picker -->
      <img
        class="w-16 finger-pointer finger-minute"
        *ngIf="hourSelected && !minuteSelected && !showMinutePicker"
        src="/pointing-left-finger-svgrepo-com.svg"
        alt="Finger pointing to the left"
      />

      <div class="time-display">
        <div
          role="button"
          tabindex="0"
          class="time-part hour"
          [class.animate-attention]="!hourSelected"
          (click)="toggleHourPicker()"
        >
          {{ selectedTime.hour.toString().padStart(2, '0') }}
        </div>
        <div class="time-separator">:</div>
        <div
          role="button"
          tabindex="0"
          class="time-part minute"
          [class.animate-attention-with-delay]="hourSelected && !minuteSelected"
          (click)="toggleMinutePicker()"
        >
          {{ selectedTime.minute.toString().padStart(2, '0') }}
        </div>
      </div>
      <div class="hour-picker" *ngIf="showHourPicker">
        <div
          role="button"
          tabindex="0"
          *ngFor="let hour of hours"
          class="minute-option shadow-lg"
          [class.selected]="selectedTime.hour === hour"
          (click)="selectHour(hour)"
        >
          {{ hour.toString().padStart(2, '0') }}
        </div>
      </div>

      <div class="minute-picker" *ngIf="showMinutePicker">
        <div
          role="button"
          tabindex="0"
          *ngFor="let minute of minutes"
          class="minute-option"
          [class.selected]="selectedTime.minute === minute"
          (click)="selectMinute(minute)"
        >
          {{ minute.toString().padStart(2, '0') }}
        </div>
      </div>
    </div>

    <div class="navigation">
      <button class="nav-button back" (click)="previousStep()">
        <!-- <span class="arrow">â†</span> -->
        <img src="/back.webp" class="arrow" alt="Back Arrow" />
      </button>
      <button class="nav-button next" (click)="nextStep()">
        <!-- <span class="arrow">â†’</span> -->
        <img src="/next.webp" class="arrow" alt="Next Arrow" />
      </button>
    </div>
  </div>

  <!-- Step 3: Scan Badge -->
  <div class="content scanner-step" *ngIf="currentStep === 3">
    <h2 class="title scan-title">{{ 'checkin.scanBadge' | translate }}</h2>

    <div class="scanner-wrapper">
      <app-scanner
        [scanZoneWidth]="'500px'"
        [scanZoneHeight]="'500px'"
        [borderColor]="'#ff0000'"
        (scanComplete)="badgeScanned($event)"
      >
      </app-scanner>
    </div>
    <!--
    <div class="navigation">
      <button class="nav-button back" (click)="previousStep()">
        <span class="arrow">â†</span>
      </button>
    </div> -->
  </div>

  <!-- Step 4: Welcome Confirmation -->
  <div class="content welcome-step" *ngIf="currentStep === 4">
    <h2 class="title welcome-title">{{ 'checkin.welcome' | translate }}</h2>

    <div class="welcome-content">
      <div class="success-badge">
        <svg width="120" height="120" viewBox="0 0 120 120">
          <circle cx="60" cy="60" r="50" fill="#4CAF50" />
          <path
            d="M35 60 L52 77 L85 44"
            stroke="white"
            stroke-width="8"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>

      <div class="go-section">
        <img src="/arrow.webp" class="arrow-icon w-48" alt="Arrow" />
        <div class="go-text">{{ 'checkin.go' | translate }}</div>
      </div>

      <div class="running-icon">
        <img src="run.webp" class="h-32" alt="Running person" />
      </div>
    </div>

    <button class="finish-button" (click)="finishCheckIn()">
      {{ 'checkin.completeCheckIn' | translate }}
    </button>
  </div>
</div>
